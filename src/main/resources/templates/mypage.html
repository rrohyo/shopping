<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:if="${_csrf != null}" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:if="${_csrf != null}" th:content="${_csrf.headerName}"/>
    <title>ë§ˆì´í˜ì´ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        /* í—¤ë” */
        .header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-logout {
            padding: 8px 16px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-menu {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .nav-menu a {
            color: #666;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-menu a:hover,
        .nav-menu a.active {
            color: #667eea;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: #f8f9fa;
            border-radius: 20px;
            font-size: 13px;
            color: #666;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* í”„ë¡œí•„ ì„¹ì…˜ */
        .profile-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            color: white;
            position: relative;
        }

        .profile-info {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: #667eea;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .profile-details h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .profile-details p {
            font-size: 14px;
            opacity: 0.9;
        }

        .profile-stats {
            display: flex;
            gap: 40px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* íƒ­ ë©”ë‰´ */
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            overflow-x: auto;
        }

        .tab-button {
            padding: 20px 25px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-button:hover {
            background: white;
        }

        .tab-button.active {
            background: white;
            color: #667eea;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: #667eea;
        }

        .tab-badge {
            background: #e74c3c;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 5px;
        }

        /* íƒ­ ì»¨í…ì¸  */
        .tab-content {
            padding: 40px;
            background: white;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* ì •ë³´ ì¹´ë“œ */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .info-card {
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 25px;
            transition: all 0.3s;
        }

        .info-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-color: #667eea;
        }

        .info-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .info-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f1f3f5;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }

        .info-value {
            font-size: 14px;
            color: #333;
            text-align: right;
        }

        /* ì£¼ë¬¸ ë‚´ì—­ ìŠ¤íƒ€ì¼ */
        .order-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .order-card {
            border: 1px solid #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .order-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .order-header {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-number {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .order-date {
            font-size: 13px;
            color: #666;
        }

        .order-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-paid {
            background: #fff3cd;
            color: #856404;
        }

        .status-ready {
            background: #cce5ff;
            color: #004085;
        }

        .status-shipping {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-delivered {
            background: #d4edda;
            color: #155724;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .order-body {
            padding: 20px;
        }

        .order-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .order-item {
            display: flex;
            gap: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f1f3f5;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-item-image {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            flex-shrink: 0;
        }

        .order-item-info {
            flex: 1;
        }

        .order-item-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .order-item-details {
            font-size: 13px;
            color: #666;
        }

        .order-item-price {
            text-align: right;
        }

        .order-price {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
        }

        .order-quantity {
            font-size: 13px;
            color: #666;
        }

        .order-footer {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-total {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        /* ìƒí’ˆ ê´€ë¦¬ í…Œì´ë¸” */
        .product-table {
            width: 100%;
            border-collapse: collapse;
        }

        .product-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #dee2e6;
        }

        .product-table td {
            padding: 15px 12px;
            border-bottom: 1px solid #f1f3f5;
            font-size: 14px;
        }

        .product-table tr:hover {
            background: #f8f9fa;
        }

        .product-info-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .product-thumb {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .product-name-cell {
            font-weight: 600;
            color: #333;
        }

        /* íŒë§¤ ë‚´ì—­ */
        .sales-card {
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .sales-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .sales-date {
            font-size: 13px;
            color: #666;
        }

        .sales-amount {
            font-size: 18px;
            font-weight: 600;
            color: #27ae60;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-outline {
            background: white;
            border: 1px solid #dee2e6;
            color: #495057;
        }

        .btn-outline:hover {
            background: #f8f9fa;
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: #333;
        }

        .empty-subtitle {
            font-size: 14px;
            margin-bottom: 30px;
        }

        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-section {
            margin-bottom: 30px;
        }

        .form-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f1f3f5;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .tabs {
                overflow-x: scroll;
            }

            .profile-info {
                flex-direction: column;
                text-align: center;
            }

            .profile-stats {
                justify-content: center;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .order-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .product-table {
                font-size: 12px;
            }

            .product-table th,
            .product-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-container">
            <a href="/home" th:href="@{/home}" class="logo">
                ğŸ›ï¸ MyShop
            </a>
            <nav class="nav-menu">
                <a href="/home" th:href="@{/home}">í™ˆ</a>
                <a href="/product/list" th:href="@{/product/list}">ìƒí’ˆëª©ë¡</a>
                <a href="/product/create" th:href="@{/product/create}">ìƒí’ˆë“±ë¡</a>
                <a th:href="@{/member/mypage}" class="active">ë§ˆì´í˜ì´ì§€</a>
                <div class="user-info" sec:authorize="isAuthenticated()">
                    <span class="user-email" sec:authentication="principal.username"></span>
                    <form th:action="@{/member/logout}" method="post" style="display:inline;">
                        <button type="submit" class="btn-logout">ë¡œê·¸ì•„ì›ƒ</button>
                    </form>
                </div>
            </nav>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container">
        <!-- í”„ë¡œí•„ ì„¹ì…˜ -->
        <div class="profile-section">
            <!-- í”„ë¡œí•„ í—¤ë” -->
            <div class="profile-header">
                <div class="profile-info">
                    <div class="profile-avatar" th:text="${#strings.substring(member.name, 0, 1)}">U</div>
                    <div class="profile-details">
                        <h1 th:text="${member.name}">ì‚¬ìš©ì ì´ë¦„</h1>
                        <p th:text="${member.email}">user@email.com</p>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-value" th:text="${orderCount != null ? orderCount : 0}">0</div>
                                <div class="stat-label">êµ¬ë§¤ ê±´ìˆ˜</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" th:text="${productCount != null ? productCount : 0}">0</div>
                                <div class="stat-label">íŒë§¤ ìƒí’ˆ</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" th:text="${salesCount != null ? salesCount : 0}">0</div>
                                <div class="stat-label">íŒë§¤ ê±´ìˆ˜</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" th:text="${#temporals.format(member.regDate, 'yyyy.MM')}">2024.01</div>
                                <div class="stat-label">ê°€ì…</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- íƒ­ ë©”ë‰´ -->
            <div class="tabs">
                <button type="button" class="tab-button active" onclick="showTab(event,'profile')">ğŸ‘¤ ë‚´ ì •ë³´</button>
                <button type="button" class="tab-button"        onclick="showTab(event,'orders')">ğŸ›’ êµ¬ë§¤ ë‚´ì—­
                    <span class="tab-badge" th:if="${orderCount > 0}" th:text="${orderCount}">0</span>
                </button>
                <button type="button" class="tab-button"        onclick="showTab(event,'product')">ğŸ“¦ íŒë§¤ ìƒí’ˆ
                    <span class="tab-badge" th:if="${productCount > 0}" th:text="${productCount}">0</span>
                </button>
                <button type="button" class="tab-button"        onclick="showTab(event,'sales')">ğŸ’° íŒë§¤ ë‚´ì—­
                    <span class="tab-badge" th:if="${salesCount > 0}" th:text="${salesCount}">0</span>
                </button>
                <button type="button" class="tab-button"        onclick="showTab(event,'edit')">âœï¸ ì •ë³´ ìˆ˜ì •</button>
                <button type="button" class="tab-button"        onclick="showTab(event,'settings')">âš™ï¸ ì„¤ì •</button>
            </div>

            <!-- íƒ­ ì»¨í…ì¸  -->
            <div class="tab-content">
                <!-- ë‚´ ì •ë³´ íƒ­ -->
                <div id="profile" class="tab-panel active">
                    <div class="info-grid">
                        <!-- ê¸°ë³¸ ì •ë³´ ì¹´ë“œ -->
                        <div class="info-card">
                            <div class="info-card-header">
                                <h3 class="info-card-title">
                                    <span>ğŸ“‹</span> ê¸°ë³¸ ì •ë³´
                                </h3>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ì´ë¦„</span>
                                <span class="info-value" th:text="${member.name}">í™ê¸¸ë™</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ì´ë©”ì¼</span>
                                <span class="info-value" th:text="${member.email}">user@email.com</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ì „í™”ë²ˆí˜¸</span>
                                <span class="info-value" th:text="${member.phoneNumber}">010-0000-0000</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ì£¼ì†Œ</span>
                                <span class="info-value" th:text="${member.address}">ì„œìš¸ì‹œ ê°•ë‚¨êµ¬</span>
                            </div>
                        </div>

                        <!-- í™œë™ ìš”ì•½ ì¹´ë“œ -->
                        <div class="info-card">
                            <div class="info-card-header">
                                <h3 class="info-card-title">
                                    <span>ğŸ“Š</span> í™œë™ ìš”ì•½
                                </h3>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ì´ êµ¬ë§¤ ê¸ˆì•¡</span>
                                <span class="info-value" th:text="${totalPurchaseAmount != null ? #numbers.formatDecimal(totalPurchaseAmount, 0, 'COMMA', 0, 'POINT') + 'ì›' : '0ì›'}">0ì›</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ì´ íŒë§¤ ê¸ˆì•¡</span>
                                <span class="info-value" th:text="${totalSalesAmount != null ? #numbers.formatDecimal(totalSalesAmount, 0, 'COMMA', 0, 'POINT') + 'ì›' : '0ì›'}">0ì›</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ê°€ì…ì¼</span>
                                <span class="info-value" th:text="${#temporals.format(member.regDate, 'yyyyë…„ MMì›” ddì¼')}">2024ë…„ 01ì›” 01ì¼</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ë§ˆì§€ë§‰ í™œë™</span>
                                <span class="info-value" th:text="${#temporals.format(member.updateDate, 'yyyy.MM.dd HH:mm')}">2024.01.01</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- êµ¬ë§¤ ë‚´ì—­ íƒ­ -->
                <div id="orders" class="tab-panel">
                    <div class="form-section">
                        <h3 class="form-title">êµ¬ë§¤ ë‚´ì—­</h3>
                    </div>

                    <!-- êµ¬ë§¤ ë‚´ì—­ ì¡´ì¬ -->
                    <div class="order-list" th:if="${orderItems != null and !#lists.isEmpty(orderItems)}">
                        <div class="order-card" th:each="item : ${orderItems}">
                            <div class="order-header">
                                <div class="order-date">
                                    ì£¼ë¬¸ì¼ì‹œ:
                                    <span th:text="${(item.order != null and item.order.orderDate != null)
            ? #temporals.format(item.order.orderDate, 'yyyy.MM.dd HH:mm')
            : 'â€”'}">â€”</span>
                                </div>

                                <!-- ìƒíƒœ/í´ë˜ìŠ¤ null-safe (enum ê¸°ì¤€) -->
                                <div class="order-status"
                                     th:classappend="${'status-' + (item.status != null ? #strings.toLowerCase(item.status) : 'paid')}"
                                     th:text="${item.status != null ? item.status : 'PAID'}">PAID</div>
                            </div>

                            <div class="order-body">
                                <div class="order-item-image">
                                    <div class="order-item-image" style="width:80px;height:80px;">
<!--                                        <img th:if="${imageUrlByPid[item.productId] != null}"-->
<!--                                             th:src="${imageUrlByPid[item.productId]}"-->
<!--                                             alt="ìƒí’ˆ ì´ë¯¸ì§€"-->
<!--                                             style="width:80px;height:80px;object-fit:cover;border-radius:6px;border:1px solid #ddd;">-->
                                        <div th:if="${not #strings.isEmpty(images)}"
                                             style="width:80px;height:80px;display:flex;align-items:center;justify-content:center;
              font-size:36px;border:1px solid #ddd;border-radius:6px;">ğŸ“¦</div>
                                    </div>
                                    <div class="order-item-info">
                                        <div class="order-item-name" th:text="${item.productName}">ìƒí’ˆëª…</div>
                                        <div class="order-item-details">
                                            íŒë§¤ì ID: <span th:text="${item.sellerId}">íŒë§¤ì</span> |
                                            ìˆ˜ëŸ‰: <span th:text="${item.quantity}">1</span>ê°œ
                                        </div>
                                    </div>
                                    <div class="order-item-price">
                                        <div class="order-price"
                                             th:text="${#numbers.formatDecimal(item.subtotal, 0, 'COMMA', 0, 'POINT') + 'ì›'}">0ì›</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- êµ¬ë§¤ ë‚´ì—­ ì—†ìŒ -->
                    <div class="empty-state" th:if="${orderItems == null or #lists.isEmpty(orderItems)}">
                        <div class="empty-icon">ğŸ›’</div>
                        <div class="empty-title">êµ¬ë§¤ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="empty-subtitle">ë§ˆìŒì— ë“œëŠ” ìƒí’ˆì„ êµ¬ë§¤í•´ë³´ì„¸ìš”!</div>
                        <a th:href="@{/product/list}" class="btn btn-primary">ìƒí’ˆ ë‘˜ëŸ¬ë³´ê¸°</a>
                    </div>
                </div>
                <!-- íŒë§¤ ìƒí’ˆ íƒ­ -->
                <div id="product" class="tab-panel">
                    <div class="form-section">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 class="form-title">ë‚´ íŒë§¤ ìƒí’ˆ (<span th:text="${product != null ? product.size() : 0}">0</span>)</h3>
                            <a href="/product/create" th:href="@{/product/create}" class="btn btn-primary btn-sm">
                                â• ìƒˆ ìƒí’ˆ ë“±ë¡
                            </a>
                        </div>
                    </div>

                    <table class="product-table" th:if="${product != null and !#lists.isEmpty(product)}">
                        <thead>
                            <tr>
                                <th>ìƒí’ˆì •ë³´</th>
                                <th>ê°€ê²©</th>
                                <th>ì¬ê³ </th>
                                <th>ë“±ë¡ì¼</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="product : ${product}">
                                <td>
                                    <div class="product-info-cell">
                                        <div class="order-item-image" style="width:80px;height:80px;">
<!--                                            <img th:if="${imageUrlByPid.containsKey(item.productId) != null}"-->
<!--                                                 th:src="${imageUrlByPid.containsKey(item.productId)}"-->
<!--                                                 alt="ìƒí’ˆ ì´ë¯¸ì§€"-->
<!--                                                 style="width:80px;height:80px;object-fit:cover;border-radius:6px;border:1px solid #ddd;">-->
                                            <div th:if="${not #strings.isEmpty(images)}"
                                                 style="width:80px;height:80px;display:flex;align-items:center;justify-content:center;
              font-size:36px;border:1px solid #ddd;border-radius:6px;">ğŸ“¦</div>
                                        </div>
                                        <div class="product-name-cell" th:text="${product.name}">ìƒí’ˆëª…</div>
                                    </div>
                                </td>
                                <td th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') + 'ì›'}">0ì›</td>
                                <td>
                                    <span th:style="${product.stock == 0 ? 'color: #e74c3c;' : ''}"
                                          th:text="${product.stock + 'ê°œ'}">0ê°œ</span>
                                </td>
                                <td th:text="${#temporals.format(product.regDate, 'yyyy.MM.dd')}">2024.01.01</td>
                                <td>
                                    <a th:href="@{/product/update/{id}(id=${product.id})}" class="btn btn-sm btn-secondary">ìˆ˜ì •</a>
                                    <a th:href="@{/product/detail/{id}(id=${product.id})}" class="btn btn-sm btn-outline">ìƒì„¸</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="empty-state" th:if="${product == null or product.isEmpty()}">
                        <div class="empty-icon">ğŸ“¦</div>
                        <div class="empty-title">ë“±ë¡í•œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="empty-subtitle">ì²« ìƒí’ˆì„ ë“±ë¡í•˜ê³  íŒë§¤ë¥¼ ì‹œì‘í•˜ì„¸ìš”!</div>
                        <a href="/product/create" th:href="@{/product/create}" class="btn btn-primary">
                            ìƒí’ˆ ë“±ë¡í•˜ê¸°
                        </a>
                    </div>
                </div>

                <!-- íŒë§¤ ë‚´ì—­ íƒ­ -->
                <div id="sales" class="tab-panel">
                    <div class="form-section">
                        <h3 class="form-title">íŒë§¤ ë‚´ì—­</h3>
                    </div>

                    <!-- íŒë§¤ ë‚´ì—­ ì¡´ì¬ -->
                    <div th:if="${salesItems != null and !#lists.isEmpty(salesItems)}">
                        <div class="sales-card" th:each="item : ${salesItems}">
                            <div class="sales-header">
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 5px;">
                                        <span th:text="${item.productName}">ìƒí’ˆëª…</span>
                                    </div>
                                    <div class="sales-date">
                                        ì£¼ë¬¸ì¼ì‹œ:
                                        <span th:text="${(item.order != null and item.order.orderDate != null)
              ? #temporals.format(item.order.orderDate, 'yyyy.MM.dd HH:mm')
              : 'â€”'}">â€”</span>
                                    </div>
                                </div>

                                <div style="text-align: right;">
                                    <div class="sales-amount"
                                         th:text="${#numbers.formatDecimal(item.subtotal, 0, 'COMMA', 0, 'POINT') + 'ì›'}">0ì›</div>

                                    <!-- íŒë§¤ìë§Œ ìƒíƒœ ë³€ê²½ ê°€ëŠ¥ (ì»¨íŠ¸ë¡¤ëŸ¬: POST /product/order/status) -->
                                    <form th:if="${session.LOGIN_MEMBER_ID != null and session.LOGIN_MEMBER_ID == item.sellerId}"
                                          th:action="@{/product/order/status}" method="post" style="display:inline;">
                                        <input type="hidden" name="orderItemId" th:value="${item.id}" />
                                        <input type="hidden" th:if="${_csrf != null}"
                                               th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                        <select name="status" onchange="this.form.submit()">
                                            <option th:each="s : ${T(com.shopping.entity.OrderStatus).values()}"
                                                    th:value="${s}"
                                                    th:text="${s}"
                                                    th:selected="${s == item.status}">PAID</option>
                                        </select>
                                    </form>
                                </div>
                            </div>

                            <div class="sales-body">
                                <div class="order-item-image">
                                    <div class="order-item-image" style="width:80px;height:80px;">
<!--                                        <img th:if="${imageUrlByPid[item.productId] != null}"-->
<!--                                             th:src="${imageUrlByPid[item.productId]}"-->
<!--                                             alt="ìƒí’ˆ ì´ë¯¸ì§€"-->
<!--                                             style="width:80px;height:80px;object-fit:cover;border-radius:6px;border:1px solid #ddd;">-->
                                        <div th:if="${not #strings.isEmpty(images)}"
                                             style="width:80px;height:80px;            background: white;
;display:flex;align-items:center;justify-content:center;
              font-size:36px;border:1px solid #ddd;border-radius:6px;">ğŸ“¦<p>fdsajklfsajlkdfjlkajfl</p></div>
                                    </div>
                                    <div class="order-item-info">
                                        <div class="order-item-details">
                                            ìˆ˜ëŸ‰: <span th:text="${item.quantity}">1</span>ê°œ
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- íŒë§¤ ë‚´ì—­ ì—†ìŒ -->
                    <div class="empty-state" th:if="${salesItems == null or #lists.isEmpty(salesItems)}">
                        <div class="empty-icon">ğŸ’°</div>
                        <div class="empty-title">íŒë§¤ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="empty-subtitle">ìƒí’ˆì´ íŒë§¤ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
                    </div>
                </div>

                <!-- ì •ë³´ ìˆ˜ì • íƒ­ -->
                <div id="edit" class="tab-panel">
                    <form th:action="@{/member/mypage/update}" method="post">
                        <div class="form-section">
                            <h3 class="form-title">ì •ë³´ ìˆ˜ì •</h3>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="name">ì´ë¦„</label>
                                    <input type="text" id="name" name="name" th:value="${member.name}" required>
                                </div>

                                <div class="form-group">
                                    <label for="email">ì´ë©”ì¼ (ë³€ê²½ë¶ˆê°€)</label>
                                    <input type="email" id="email" name="email" th:value="${member.email}" disabled>
                                </div>

                                <div class="form-group">
                                    <label for="phoneNumber">ì „í™”ë²ˆí˜¸</label>
                                    <input type="tel" id="phoneNumber" name="phoneNumber" th:value="${member.phoneNumber}" required>
                                </div>

                                <div class="form-group" style="grid-column: 1 / -1;">
                                    <label for="address">ì£¼ì†Œ</label>
                                    <input type="text" id="address" name="address" th:value="${member.address}" required>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary">ì •ë³´ ìˆ˜ì •</button>
                        </div>
                    </form>
                </div>


                <!-- ì„¤ì • íƒ­ -->
                <div id="settings" class="tab-panel">
                    <div class="form-section">
                        <h3 class="form-title">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
                        <form th:action="@{/member/mypage/password}" method="post">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="currentPassword">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                                    <input type="password" id="currentPassword" name="currentPassword" required>
                                </div>
                                <div class="form-group">
                                    <label for="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                                    <input type="password" id="newPassword" name="newPassword" required>
                                </div>
                                <div class="form-group">
                                    <label for="confirmPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // íƒ­ ì „í™˜ í•¨ìˆ˜ (í•­ìƒ e, tabName ìˆœì„œë¡œ)
        function showTab(e, tabName) {
          if (e && e.preventDefault) e.preventDefault();

          // íŒ¨ë„/ë²„íŠ¼ active ì´ˆê¸°í™”
          document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
          document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));

          // ëŒ€ìƒ íŒ¨ë„ í™œì„±í™”
          const panel = document.getElementById(tabName);
          if (panel) panel.classList.add('active');

          // í´ë¦­í•œ ë²„íŠ¼ í™œì„±í™”
          if (e && e.currentTarget) e.currentTarget.classList.add('active');
          else {
            // URL íŒŒë¼ë¯¸í„°ë¡œ ì—´ì—ˆì„ ë•Œ: í•´ë‹¹ íƒ­ ë²„íŠ¼ë„ active ì£¼ê¸°
            const btn = Array.from(document.querySelectorAll('.tab-button'))
              .find(b => b.getAttribute('onclick')?.includes("'" + tabName + "'"));
            if (btn) btn.classList.add('active');
          }
        }

        // URL íŒŒë¼ë¯¸í„°ë¡œ íƒ­ ì—´ê¸° (?tab=sales ë“±)
        (function () {
          const params = new URLSearchParams(window.location.search);
          const tab = params.get('tab');
          if (tab) showTab(null, tab);   // <- í•­ìƒ (null, tabName) í˜•íƒœë¡œ
        })();
    </script>
</body>
</html>